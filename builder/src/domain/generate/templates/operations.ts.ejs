import { EventStream, CommandContext } from '@root/common';
import { handleCreateCommand, handleUpdateCommand } from '../../../common/handleCommand';
import { CommandEventEvolver } from "../../../common/evolve";

//--------------------------------
//--------------------------------

import { <%= aggregateTypeName %> } from '../<%= aggregateFileName %>';

<% evolvers.forEach(function (evolver) { %>
import { <%= evolver.evolverFunctionName %> } from "../<%= evolver.command %>/<%= evolver.evolverFileName %>";
<% }) %>

export const commandEventEvolvers: CommandEventEvolver<<%= aggregateTypeName %>>[] = [
    <% evolvers.forEach(function (evolver) { %>
    <%= evolver.evolverFunctionName %>,
    <% }) %>    
];


//--------------------------------
//--------------------------------


<% commands.forEach(function (command) { %>

    //--------------------------------

    import { <%= command.commandTypeName %> } from '../<%= command.commandFolderName %>/<%= command.commandFileName %>';
    import { <%= command.handleFunctionName %> } from '../<%= command.commandFolderName %>/<%= command.handleFileName %>';
    <% if (command.validator) { %>  
        import { <%= command.validator.functionName %> } from '../<%= command.commandFolderName %>/<%= command.validator.importName %>';
    <% } %>
    <% command.commandRules.forEach(function (rule) { %>
        import { <%= rule.functionName %> } from '../<%= command.commandFolderName %>/commandRules/<%= rule.importName %>';
    <% }) %>
    <% command.commandIndexRules.forEach(function (rule) { %>
        import { <%= rule.functionName %> } from '../<%= command.commandFolderName %>/indexRules/<%= rule.importName %>';
    <% }) %>
    <% command.commandAggregateRules.forEach(function (rule) { %>
        import { <%= rule.functionName %> } from '../<%= command.commandFolderName %>/aggregateRules/<%= rule.importName %>';
    <% }) %>    

    <% if (command.commandType === 'create') { %>  
        export const <%= command.operationFunctionName %> = (command: <%= command.commandTypeName %>, context: CommandContext) => handleCreateCommand(
            '<%= aggregateTypeName %>', 
            command, 
            <%= command.handleFunctionName %>, 
            <% if (command.validator) { %>  
                <%= command.validator.functionName %>
            <% } else { %>  
                undefined
            <% } %>,
            [ <%= command.commandRuleFunctionNames %> ],
            [ <%= command.commandIndexRuleFunctionNames %> ],
            context.eventStream,
            context.generateUuid
        );
    <% } %>
    <% if (command.commandType === 'update') { %>  
        export const <%= command.operationFunctionName %> = (command: <%= command.commandTypeName %>, context: CommandContext) => handleUpdateCommand(
            '<%= aggregateTypeName %>', 
            command, 
            commandEventEvolvers, 
            <%= command.handleFunctionName %>, 
            <% if (command.validator) { %>  
                <%= command.validator.functionName %>
            <% } else { %>  
                undefined
            <% } %>,
            [ <%= command.commandRuleFunctionNames %> ],
            [ <%= command.commandIndexRuleFunctionNames %> ],
            [ <%= command.commandAggregateRuleFunctionNames %> ],
            context.eventStream,
            context.generateUuid
        );
    <% } %>
<% }) %>    
